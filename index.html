<html lang="en" x-data="appData()" x-init="init()" :class="theme">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAIA Benchmark Data Explorer</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        :root {
            --color-background-dark: #1a1b26;
            --color-surface-dark: #24283b;
            --color-primary-dark: #7aa2f7;
            --color-secondary-dark: #bb9af7;
            --color-tertiary-dark: #7dcfff;
            --color-text-primary-dark: #c0caf5;
            --color-text-secondary-dark: #a9b1d6;
            --color-border-dark: #414868;
            --color-success-dark: #9ece6a;
            --color-warning-dark: #e0af68;
            --color-danger-dark: #f7768e;

            --color-background-light: #f0f0f0;
            --color-surface-light: #ffffff;
            --color-primary-light: #3b82f6;
            /* A more standard blue for light mode */
            --color-secondary-light: #8b5cf6;
            /* A more standard purple for light mode */
            --color-tertiary-light: #06b6d4;
            /* A more standard cyan for light mode */
            --color-text-primary-light: #1f2937;
            /* Dark gray for text */
            --color-text-secondary-light: #4b5563;
            /* Medium gray */
            --color-border-light: #d1d5db;
            --color-success-light: #10b981;
            --color-warning-light: #f59e0b;
            --color-danger-light: #ef4444;

            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition-duration: 0.2s;
            --sidebar-width: 320px;
        }

        html.dark {
            --color-background: var(--color-background-dark);
            --color-surface: var(--color-surface-dark);
            --color-primary: var(--color-primary-dark);
            --color-secondary: var(--color-secondary-dark);
            --color-tertiary: var(--color-tertiary-dark);
            --color-text-primary: var(--color-text-primary-dark);
            --color-text-secondary: var(--color-text-secondary-dark);
            --color-border: var(--color-border-dark);
            --color-success: var(--color-success-dark);
            --color-warning: var(--color-warning-dark);
            --color-danger: var(--color-danger-dark);
            --color-primary-rgb: 122, 162, 247;
            --color-background-rgb: 26, 27, 38;
        }

        html.light {
            --color-background: var(--color-background-light);
            --color-surface: var(--color-surface-light);
            --color-primary: var(--color-primary-light);
            --color-secondary: var(--color-secondary-light);
            --color-tertiary: var(--color-tertiary-light);
            --color-text-primary: var(--color-text-primary-light);
            --color-text-secondary: var(--color-text-secondary-light);
            --color-border: var(--color-border-light);
            --color-success: var(--color-success-light);
            --color-warning: var(--color-warning-light);
            --color-danger: var(--color-danger-light);
            --color-primary-rgb: 59, 130, 246;
            --color-background-rgb: 240, 240, 240;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: 1.6;
            font-size: 16px;
            overflow-x: hidden;
            transition: background-color var(--transition-duration), color var(--transition-duration);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--color-surface);
            padding: 24px;
            border-right: 1px solid var(--color-border);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            transition: transform var(--transition-duration) ease-in-out, background-color var(--transition-duration), border-color var(--transition-duration);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .sidebar h2 svg {
            margin-right: 10px;
            min-width: 28px;
        }

        .sidebar-header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sidebar-scrollable-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .sidebar-scrollable-content::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar-scrollable-content::-webkit-scrollbar-track {
            background: var(--color-surface);
        }

        .sidebar-scrollable-content::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 4px;
        }

        .sidebar-scrollable-content::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-section h3 {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 6px;
            display: flex;
            align-items: center;
        }

        .sidebar-section h3 svg {
            margin-right: 8px;
        }

        .sidebar label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text-secondary);
        }

        .sidebar input[type="text"],
        .sidebar select {
            width: 100%;
            padding: 10px;
            background-color: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            color: var(--color-text-primary);
            font-size: 0.9em;
            transition: border-color var(--transition-duration), box-shadow var(--transition-duration), background-color var(--transition-duration), color var(--transition-duration);
        }

        .sidebar input[type="text"]:focus,
        .sidebar select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.3);
        }

        .sidebar input[type="checkbox"] {
            margin-right: 8px;
            accent-color: var(--color-primary);
            transform: scale(1.1);
        }

        .sidebar .checkbox-group label {
            font-weight: normal;
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: background-color var(--transition-duration), transform var(--transition-duration), box-shadow var(--transition-duration), color var(--transition-duration);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-surface);
        }

        html.light .btn-primary {
            color: var(--color-background-light);
        }

        /* Ensure contrast in light mode */
        .btn-primary:hover {
            background-color: var(--color-secondary);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: var(--color-surface);
        }

        html.light .btn-secondary {
            color: var(--color-background-light);
        }

        .btn-secondary:hover {
            background-color: var(--color-primary);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-tertiary {
            background-color: var(--color-tertiary);
            color: var(--color-background);
        }

        .btn-tertiary:hover {
            background-color: #9adfff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
        }

        .btn-outline:hover {
            background-color: rgba(var(--color-primary-rgb), 0.1);
            transform: translateY(-1px);
        }

        .btn svg {
            margin-right: 8px;
        }

        .btn-full {
            width: 100%;
            margin-top: 10px;
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 5px;
            color: var(--color-text-secondary);
        }

        .icon-btn:hover {
            color: var(--color-primary);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 24px;
            width: calc(100% - var(--sidebar-width));
            transition: margin-left var(--transition-duration) ease-in-out, width var(--transition-duration) ease-in-out;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            transition: border-color var(--transition-duration);
        }

        .main-header h1 {
            font-size: 2em;
            color: var(--color-text-primary);
            transition: color var(--transition-duration);
        }

        .current-dataset-indicator {
            font-size: 0.85em;
            color: var(--color-text-secondary);
            background-color: var(--color-surface);
            padding: 5px 10px;
            border-radius: var(--border-radius);
        }

        .dataset-switcher {
            display: flex;
            gap: 10px;
        }

        .dataset-switcher .btn {
            padding: 8px 12px;
            font-size: 0.9em;
        }

        .dataset-switcher .btn.active {
            background-color: var(--color-primary);
            color: var(--color-background);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.4), inset 0 1px 2px rgba(0, 0, 0, 0.2);
            /* More prominent */
            font-weight: 600;
        }

        .dataset-switcher .btn:not(.active) {
            background-color: var(--color-surface);
            color: var(--color-text-secondary);
            border: 1px solid var(--color-border);
        }

        .dataset-switcher .btn:not(.active):hover {
            background-color: var(--color-border);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 24px;
            padding: 15px;
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: background-color var(--transition-duration);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            background-color: var(--color-background);
            transition: background-color var(--transition-duration);
        }

        .stat-item .value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--color-primary);
        }

        .stat-item .label {
            font-size: 0.8em;
            color: var(--color-text-secondary);
            text-align: center;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .item-card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-duration), box-shadow var(--transition-duration), background-color var(--transition-duration), border-left-color var(--transition-duration);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border-left: 4px solid transparent;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            border-left-color: var(--color-primary);
        }

        .item-card h4 {
            font-size: 1.05em;
            color: var(--color-primary);
            margin-bottom: 8px;
            word-break: break-all;
        }

        .item-card .question-preview {
            font-size: 0.9em;
            color: var(--color-text-primary);
            margin-bottom: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            white-space: pre-wrap;
            flex-grow: 1;
            min-height: 70px;
        }

        .item-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: var(--color-text-secondary);
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid var(--color-border);
            transition: border-color var(--transition-duration);
        }

        .level-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            color: #fff;
            /* Ensure white text for contrast */
        }

        html.dark .level-badge {
            color: var(--color-background-dark);
        }

        html.light .level-badge {
            color: var(--color-background-light);
        }

        .level-1 {
            background-color: var(--color-success);
        }

        .level-2 {
            background-color: var(--color-warning);
        }

        .level-3 {
            background-color: var(--color-danger);
        }

        .file-indicator svg {
            width: 18px;
            height: 18px;
            fill: var(--color-secondary);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            user-select: none;
        }

        .pagination button,
        .pagination span {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid var(--color-border);
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-duration), color var(--transition-duration), border-color var(--transition-duration);
        }

        .pagination button:hover:not(:disabled) {
            background-color: var(--color-primary);
            color: var(--color-background);
            border-color: var(--color-primary);
        }

        html.light .pagination button:hover:not(:disabled) {
            color: #fff;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--color-border);
        }

        .pagination .active-page {
            background-color: var(--color-primary);
            color: var(--color-background);
            border-color: var(--color-primary);
            font-weight: 600;
        }

        html.light .pagination .active-page {
            color: #fff;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-duration), visibility var(--transition-duration);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--color-surface);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transform: scale(0.95) translateY(20px);
            transition: transform var(--transition-duration) 0.1s, opacity var(--transition-duration) 0.1s, background-color var(--transition-duration);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            transition: border-color var(--transition-duration);
        }

        .modal-header h3 {
            font-size: 1.6em;
            color: var(--color-primary);
            word-break: break-all;
        }

        .modal-copy-button {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            margin-left: 10px;
            padding: 5px;
        }

        .modal-copy-button:hover svg {
            fill: var(--color-primary);
        }

        .modal-copy-button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .copy-feedback {
            font-size: 0.8em;
            color: var(--color-success);
            margin-left: 5px;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: 2em;
            cursor: pointer;
            transition: color var(--transition-duration), transform var(--transition-duration);
            padding: 0 5px;
        }

        .modal-close-btn:hover {
            color: var(--color-primary);
            transform: rotate(90deg);
        }

        .modal-body .detail-group {
            margin-bottom: 20px;
        }

        .modal-body .detail-group strong {
            display: block;
            color: var(--color-secondary);
            margin-bottom: 8px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-body .detail-group p,
        .modal-body .detail-group div {
            background-color: rgba(var(--color-background-rgb), 0.7);
            padding: 12px;
            border-radius: var(--border-radius);
            font-size: 0.95em;
            white-space: pre-wrap;
            word-break: break-word;
            border: 1px solid var(--color-border);
            transition: background-color var(--transition-duration), border-color var(--transition-duration);
        }

        .modal-body .detail-group a {
            color: var(--color-primary);
            text-decoration: none;
            word-break: break-all;
            font-weight: 500;
        }

        .modal-body .detail-group a:hover {
            text-decoration: underline;
            color: var(--color-tertiary);
        }

        .modal-body .annotator-metadata-item {
            margin-bottom: 10px;
        }

        .modal-body .annotator-metadata-item strong {
            color: var(--color-text-secondary);
            text-transform: none;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .modal-body .annotator-metadata-item span {
            display: block;
            padding-left: 15px;
            font-size: 0.9em;
            color: var(--color-text-primary);
        }

        .modal-body pre {
            background-color: var(--color-background);
            color: var(--color-text-primary);
            padding: 15px;
            border-radius: var(--border-radius);
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.85em;
            border: 1px solid var(--color-border);
            transition: background-color var(--transition-duration), color var(--transition-duration), border-color var(--transition-duration);
        }

        /* Loading and Error States */
        .loading-overlay,
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(var(--color-background-rgb), 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: var(--color-text-primary);
            padding: 20px;
            text-align: center;
        }

        .spinner {
            border: 6px solid var(--color-border);
            border-top: 6px solid var(--color-primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message,
        .info-message {
            background-color: var(--color-danger);
            color: var(--color-background);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px auto;
            text-align: center;
            max-width: 80%;
            box-shadow: var(--box-shadow);
        }

        html.light .error-message {
            color: #fff;
        }

        .info-message {
            background-color: var(--color-tertiary);
        }

        .welcome-overlay h2 {
            color: var(--color-primary);
            margin-bottom: 15px;
        }

        .welcome-overlay p {
            margin-bottom: 20px;
            max-width: 500px;
            line-height: 1.7;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-secondary);
            font-size: 1.25em;
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            margin-top: 20px;
            transition: background-color var(--transition-duration), color var(--transition-duration);
        }

        .no-results svg {
            width: 50px;
            height: 50px;
            fill: var(--color-text-secondary);
            margin-bottom: 15px;
            opacity: 0.7;
        }

        /* Scroll to Top Button */
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--color-primary);
            color: var(--color-background);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: opacity var(--transition-duration), visibility var(--transition-duration), transform var(--transition-duration), background-color var(--transition-duration);
            z-index: 900;
        }

        html.light .scroll-to-top {
            color: #fff;
        }

        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .scroll-to-top:hover {
            background-color: var(--color-secondary);
            transform: scale(1.1) translateY(0);
        }

        .scroll-to-top svg {
            width: 24px;
            height: 24px;
        }

        /* Sidebar Toggle */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 110;
            background-color: var(--color-primary);
            color: var(--color-background);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: background-color var(--transition-duration);
        }

        html.light .sidebar-toggle {
            color: #fff;
        }

        .sidebar-toggle:hover {
            background-color: var(--color-secondary);
        }

        @media (max-width: 900px) {
            .sidebar {
                transform: translateX(-100%);
                box-shadow: var(--box-shadow);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .items-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" :class="{ 'open': sidebarOpen }">
            <div class="sidebar-header-controls">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28"
                        height="28">
                        <path
                            d="M10.56 11.47a.75.75 0 0 0-1.06 1.06l3 3a.75.75 0 0 0 1.06 0l3-3a.75.75 0 0 0-1.06-1.06l-1.72 1.72V3.75a.75.75 0 0 0-1.5 0v9.44L10.56 11.47ZM19.5 21a.75.75 0 0 0 .75-.75V18a.75.75 0 0 0-1.5 0v2.25H5.25V18a.75.75 0 0 0-1.5 0v2.25A.75.75 0 0 0 4.5 21h15Z" />
                    </svg>
                    GAIA Explorer
                </h2>
                <button @click="toggleTheme" class="icon-btn"
                    :title="theme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
                    <svg x-show="theme === 'dark'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                        fill="currentColor" width="22" height="22">
                        <path fill-rule="evenodd"
                            d="M7.455 2.004a.75.75 0 0 1 .26.77 7 7 0 0 0 9.958 7.967.75.75 0 0 1 1.067.853A8.5 8.5 0 1 1 6.647 1.921a.75.75 0 0 1 .808.083Z"
                            clip-rule="evenodd" />
                    </svg>
                    <svg x-show="theme === 'light'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                        fill="currentColor" width="22" height="22">
                        <path
                            d="M10 7a3 3 0 1 0 0 6 3 3 0 0 0 0-6ZM10 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10ZM10 0a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 10 0ZM18.25 10a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 .75.75ZM10 18.25a.75.75 0 0 1-.75.75v1.5a.75.75 0 0 1 1.5 0v-1.5a.75.75 0 0 1-.75-.75ZM1.75 10a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM4.22 14.22a.75.75 0 0 1 0 1.06l-1.06 1.06a.75.75 0 0 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0ZM15.78 4.22a.75.75 0 0 1 0 1.06l-1.06 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0ZM14.22 4.22a.75.75 0 0 1 1.06 0l1.06 1.06a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06ZM4.22 15.78a.75.75 0 0 1 1.06 0l1.06 1.06a.75.75 0 1 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Z" />
                    </svg>
                </button>
            </div>

            <div class="sidebar-scrollable-content">
                <div class="sidebar-section">
                    <h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path
                                d="M2.5 2A1.5 1.5 0 0 0 1 3.5v13A1.5 1.5 0 0 0 2.5 18h15a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 17.5 2h-15Zm13.5 1.5H4v2h12V5h-2V3.5ZM16 8H4v8h12V8Z" />
                        </svg>
                        Dataset Controls
                    </h3>
                    <div class="dataset-switcher">
                        <button @click="setActiveDatasetType('test')" class="btn"
                            :class="{'active': activeDatasetType === 'test'}">Test Set</button>
                        <button @click="setActiveDatasetType('validation')" class="btn"
                            :class="{'active': activeDatasetType === 'validation'}">Validation Set</button>
                    </div>
                    <button @click="loadDataFromURLs(true)" class="btn btn-primary btn-full" style="margin-top: 15px;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="18"
                            height="18">
                            <path fill-rule="evenodd"
                                d="M15.312 11.424a5.5 5.5 0 0 1-9.204 2.103l-1.11 1.11a.75.75 0 0 0 1.06 1.06l1.11-1.11a5.5 5.5 0 0 1 11.307-1.065c1.14-.083 2.131-.469 2.869-1.149a.75.75 0 0 0-1.022-1.094c-.541.461-1.264.73-2.002.796a5.506 5.506 0 0 1-1.008-.062Zm-2.09-4.129a.75.75 0 0 0-1.022 1.094c.738.679 1.73 1.065 2.869 1.149A5.506 5.506 0 0 1 15 8.5a5.5 5.5 0 0 1-9.204-2.103L4.686 7.507a.75.75 0 0 0 1.06 1.06l1.11-1.11a5.5 5.5 0 0 1 7.495-1.096Z"
                                clip-rule="evenodd" />
                        </svg>
                        Reload Data from URLs
                    </button>
                </div>

                <div class="sidebar-section">
                    <h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path fill-rule="evenodd"
                                d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z"
                                clip-rule="evenodd" />
                        </svg>
                        Search
                    </h3>
                    <input type="text" x-model.debounce.300ms="searchTerm" @input="applyFiltersAndSearch"
                        placeholder="Task ID or Question keywords...">
                </div>

                <div class="sidebar-section">
                    <h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path
                                d="M2.5 3A1.5 1.5 0 0 0 1 4.5v11A1.5 1.5 0 0 0 2.5 17h15a1.5 1.5 0 0 0 1.5-1.5v-11A1.5 1.5 0 0 0 17.5 3h-15ZM3.5 6h13v8h-13V6Z" />
                        </svg>
                        Filter by Level
                    </h3>
                    <div class="checkbox-group">
                        <template x-for="level in [1, 2, 3]" :key="level">
                            <label>
                                <input type="checkbox" :value="level" x-model="filterLevels"
                                    @change="applyFiltersAndSearch">
                                Level <span x-text="level"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path fill-rule="evenodd"
                                d="M15.621 4.379a3 3 0 0 0-4.242 0l-7 7a3 3 0 0 0 4.241 4.243h.001l.497-.5a.75.75 0 0 1 1.064 1.057l-.498.501-.002.002a4.5 4.5 0 0 1-6.364-6.364l7-7a4.5 4.5 0 0 1 6.368 6.36l-3.455 3.553A2.625 2.625 0 1 1 9.52 9.52l3.45-3.451a.75.75 0 1 1 1.061 1.06l-3.45 3.451a1.125 1.125 0 0 0 1.587 1.595l3.454-3.553a3 3 0 0 0 0-4.242Z"
                                clip-rule="evenodd" />
                        </svg>
                        Filter by File
                    </h3>
                    <select x-model="filterHasFile" @change="applyFiltersAndSearch">
                        <option value="any">Any</option>
                        <option value="yes">Has Associated File</option>
                        <option value="no">No Associated File</option>
                    </select>
                </div>

                <div class="sidebar-section">
                    <h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path fill-rule="evenodd"
                                d="M2 4.75A.75.75 0 0 1 2.75 4h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.75Zm7 10.5a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5a.75.75 0 0 1-.75-.75ZM2 9.75A.75.75 0 0 1 2.75 9h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 9.75Z"
                                clip-rule="evenodd" />
                        </svg>
                        Sort By
                    </h3>
                    <select x-model="sortBy" @change="applyFiltersAndSearch">
                        <option value="task_id">Task ID</option>
                        <option value="Level">Level</option>
                        <option value="Question">Question</option>
                    </select>
                    <select x-model="sortOrder" @change="applyFiltersAndSearch" style="margin-top: 8px;">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>

                <button @click="clearFilters" class="btn btn-outline btn-full">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="18"
                        height="18">
                        <path fill-rule="evenodd"
                            d="M2.5 1a1 1 0 0 0-1 1v1.257a1 1 0 0 0 .293.708l4.07 4.07a1 1 0 0 1 .292.707V14.5a1 1 0 0 0 .5.866l2 1.333a1 1 0 0 0 1.5-.866V8.743a1 1 0 0 1 .293-.707l4.07-4.07A1 1 0 0 0 18.5 3.257V2a1 1 0 0 0-1-1h-15Zm0 2.5h15V2H2.5v1.5Z"
                            clip-rule="evenodd" />
                    </svg>
                    Clear Filters
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <button class="sidebar-toggle" @click="sidebarOpen = !sidebarOpen" aria-label="Toggle sidebar">
                <svg x-show="!sidebarOpen" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
                <svg x-show="sidebarOpen" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>

            <header class="main-header">
                <h1>GAIA Benchmark Data</h1>
                <span class="current-dataset-indicator" x-show="currentDatasetItems.length > 0"
                    x-text="`Viewing: ${activeDatasetType.charAt(0).toUpperCase() + activeDatasetType.slice(1)} Set`"></span>
            </header>

            <div x-show="isLoading && !(allTestData.length || allValidationData.length)" class="loading-overlay">
                <div class="spinner"></div>
                <p>Fetching benchmark data from GitHub...</p>
            </div>

            <div x-show="!isLoading && !(allTestData.length || allValidationData.length) && !error"
                class="welcome-overlay">
                <h2>Welcome to GAIA Data Explorer!</h2>
                <p>Attempting to load data from GitHub. If this persists, there might be an issue fetching the data or
                    the datasets are empty.</p>
                <button @click="loadDataFromURLs(true)" class="btn btn-primary">Retry Loading Data</button>
            </div>

            <div x-show="error" class="error-message" x-html="error"></div>
            <!-- Use x-html for potential links in error -->

            <div x-show="!error && (allTestData.length || allValidationData.length)">
                <div x-show="isLoading" class="loading-overlay"
                    style="position: absolute; background-color: rgba(var(--color-background-rgb), 0.5);">
                    <!-- More subtle loading for filtering -->
                    <div class="spinner"></div>
                </div>
                <div x-show="!isLoading">
                    <div class="stats-bar">
                        <div class="stat-item">
                            <span class="value" x-text="stats.totalDisplayed"></span>
                            <span class="label">Displayed Items</span>
                        </div>
                        <div class="stat-item">
                            <span class="value" x-text="stats.totalInDataset"></span>
                            <span class="label"
                                x-text="`Total in ${activeDatasetType.charAt(0).toUpperCase() + activeDatasetType.slice(1)}`"></span>
                        </div>
                        <template x-for="level in [1, 2, 3]" :key="level">
                            <div class="stat-item">
                                <span class="value" x-text="stats.countByLevel[level] || 0"></span>
                                <span class="label" x-text="`Level ${level}`"></span>
                            </div>
                        </template>
                        <div class="stat-item">
                            <span class="value" x-text="stats.withFiles"></span>
                            <span class="label">With Files</span>
                        </div>
                    </div>

                    <div class="items-grid" x-show="displayedItems.length > 0">
                        <template x-for="item in displayedItems" :key="item.task_id">
                            <div class="item-card" @click="openModal(item)" role="button"
                                :aria-label="`View details for task ${item.task_id}`">
                                <h4><span x-text="item.task_id"></span></h4>
                                <p class="question-preview" x-text="item.Question"></p>
                                <div class="item-card-footer">
                                    <span :class="`level-badge level-${item.Level}`"
                                        x-text="`Level ${item.Level}`"></span>
                                    <span class="file-indicator" x-show="item.file_name"
                                        :title="`File: ${item.file_name}`">
                                        <div x-html="getFileTypeIcon(item.file_name)"></div>
                                    </span>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div x-show="displayedItems.length === 0 && currentDatasetItems.length > 0" class="no-results">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z"
                                clip-rule="evenodd" />
                        </svg>
                        <p>No items match your current filters.</p>
                        <button @click="clearFilters" class="btn btn-tertiary">Clear Filters</button>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" x-show="totalPages > 1">
                        <button @click="prevPage" :disabled="currentPage === 1" aria-label="Previous page">&laquo;
                            Prev</button>
                        <template x-for="page in paginationPages" :key="page">
                            <button x-text="page" @click="goToPage(page)"
                                :class="{'active-page': currentPage === page, 'dots': page === '...'}"
                                :disabled="page === '...'"
                                :aria-label="page === '...' ? 'More pages' : `Go to page ${page}`"
                                :aria-current="currentPage === page ? 'page' : false"></button>
                        </template>
                        <button @click="nextPage" :disabled="currentPage === totalPages" aria-label="Next page">Next
                            &raquo;</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" x-show="selectedItem" @click.self="closeModal()" :class="{'active': selectedItem}"
        role="dialog" aria-modal="true" :aria-labelledby="selectedItem ? 'modal-title-' + selectedItem.task_id : null">
        <div class="modal-content" x-show="selectedItem" @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform scale-90"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-90">
            <div class="modal-header">
                <h3 x-text="selectedItem?.task_id" :id="selectedItem ? 'modal-title-' + selectedItem.task_id : null">
                </h3>
                <div>
                    <button @click="copyToClipboard(selectedItem?.task_id, 'task_id_copy_feedback')"
                        class="modal-copy-button" title="Copy Task ID">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4 2a1.5 1.5 0 0 0-1.5 1.5v9A1.5 1.5 0 0 0 4 14h8a1.5 1.5 0 0 0 1.5-1.5V7.379a1.5 1.5 0 0 0-.44-1.06L9.68 2.44A1.5 1.5 0 0 0 8.62 2H4Zm2.25 3.5a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5h-3.5Z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                    <span class="copy-feedback" x-ref="task_id_copy_feedback"></span>
                    <button @click="closeModal()" class="modal-close-btn" aria-label="Close modal">&times;</button>
                </div>
            </div>
            <div class="modal-body" x-if="selectedItem">
                <div class="detail-group">
                    <strong>Question:</strong>
                    <p x-text="selectedItem.Question"></p>
                </div>
                <div class="detail-group">
                    <strong>Level:</strong>
                    <p x-text="selectedItem.Level"></p>
                </div>
                <div class="detail-group">
                    <strong>File Name:</strong>
                    <template x-if="selectedItem.file_name">
                        <p style="display: flex; align-items: center; gap: 8px;">
                            <span x-html="getFileTypeIcon(selectedItem.file_name, 20)"></span>
                            <a :href="getFileLink(selectedItem.file_name, selectedItem)" target="_blank"
                                rel="noopener noreferrer" x-text="selectedItem.file_name"></a>
                        </p>
                    </template>
                    <template x-if="!selectedItem.file_name">
                        <p>N/A</p>
                    </template>
                </div>
                <div class="detail-group">
                    <strong>Final Answer:</strong>
                    <p x-text="selectedItem['Final answer']"></p>
                </div>
                <div class="detail-group">
                    <strong>Annotator Metadata:</strong>
                    <div>
                        <template x-if="parsedAnnotatorMetadata && Object.keys(parsedAnnotatorMetadata).length > 0">
                            <template x-for="([key, value]) in Object.entries(parsedAnnotatorMetadata)" :key="key">
                                <div class="annotator-metadata-item">
                                    <strong x-text="formatMetadataKey(key) + ':'"></strong>
                                    <span
                                        x-text="value !== '' && value !== null && value !== undefined ? value : 'N/A'"></span>
                                </div>
                            </template>
                        </template>
                        <template x-if="!parsedAnnotatorMetadata || Object.keys(parsedAnnotatorMetadata).length === 0">
                            <span>N/A</span>
                        </template>
                    </div>
                </div>
                <div class="detail-group">
                    <strong>Raw JSON:</strong>
                    <pre x-text="JSON.stringify(selectedItem, null, 2)"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <div class="scroll-to-top" x-show="showScrollToTop" @click="scrollToTop" :class="{'visible': showScrollToTop}"
        title="Scroll to top">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
        </svg>
    </div>

    <script>
        const GITHUB_RAW_BASE_URL = 'https://raw.githubusercontent.com/dat-lequoc/gaia-solver/main/';
        const TEST_DATA_URL = GITHUB_RAW_BASE_URL + '2023/test/metadata.jsonl';
        const VALIDATION_DATA_URL = GITHUB_RAW_BASE_URL + '2023/validation/metadata.jsonl';

        function appData() {
            return {
                allTestData: [],
                allValidationData: [],

                activeDatasetType: 'test',
                currentDatasetYear: '2023',

                displayedItems: [],
                filteredItemsCache: [],

                searchTerm: '',
                filterLevels: [1, 2, 3],
                filterHasFile: 'any',
                sortBy: 'task_id',
                sortOrder: 'asc',

                currentPage: 1,
                itemsPerPage: 12,
                totalPages: 0,

                selectedItem: null,
                parsedAnnotatorMetadata: null,

                isLoading: true, // Start as true since we auto-load
                error: null,
                sidebarOpen: false,
                theme: 'dark', // Default theme

                stats: {
                    totalDisplayed: 0,
                    totalInDataset: 0,
                    countByLevel: {},
                    withFiles: 0,
                },
                showScrollToTop: false,

                init() {
                    this.theme = localStorage.getItem('gaia-theme') || 'dark';
                    this.activeDatasetType = localStorage.getItem('gaia-activeDataset') || 'test';

                    this.loadDataFromURLs();

                    window.addEventListener('scroll', () => {
                        this.showScrollToTop = window.scrollY > 200;
                    });
                    window.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            if (this.selectedItem) this.closeModal();
                            else if (this.sidebarOpen) this.sidebarOpen = false;
                        }
                    });
                },

                get currentDatasetItems() {
                    if (this.activeDatasetType === 'test') return this.allTestData;
                    if (this.activeDatasetType === 'validation') return this.allValidationData;
                    return [];
                },

                async loadDataFromURLs(forceReload = false) {
                    if (!forceReload && (this.allTestData.length > 0 || this.allValidationData.length > 0) && !this.error) {
                        // Data already loaded, just apply filters (e.g., on initial load from localStorage settings)
                        this.applyFiltersAndSearch();
                        return;
                    }

                    this.isLoading = true;
                    this.error = null;
                    try {
                        const [testData, validationData] = await Promise.all([
                            this.fetchDataset(TEST_DATA_URL, 'test'),
                            this.fetchDataset(VALIDATION_DATA_URL, 'validation')
                        ]);
                        this.allTestData = testData;
                        this.allValidationData = validationData;

                        // Ensure activeDatasetType is valid if one failed to load
                        if (this.activeDatasetType === 'test' && !this.allTestData.length && this.allValidationData.length) {
                            this.activeDatasetType = 'validation';
                        } else if (this.activeDatasetType === 'validation' && !this.allValidationData.length && this.allTestData.length) {
                            this.activeDatasetType = 'test';
                        }

                        this.applyFiltersAndSearch();

                    } catch (err) {
                        console.error("Error loading datasets from URLs:", err);
                        this.error = `Failed to load benchmark data from GitHub. Please check your internet connection and the console for details. <br>Attempted URLs: <br><a href="${TEST_DATA_URL}" target="_blank" rel="noopener noreferrer">${TEST_DATA_URL}</a> <br><a href="${VALIDATION_DATA_URL}" target="_blank" rel="noopener noreferrer">${VALIDATION_DATA_URL}</a>`;
                        // Clear data if fetch fails to avoid using stale data
                        this.allTestData = [];
                        this.allValidationData = [];
                        this.displayedItems = [];
                        this.filteredItemsCache = [];
                        this.calculateStats();
                    } finally {
                        this.isLoading = false;
                    }
                },

                async fetchDataset(url, datasetNameForError) {
                    try {
                        const response = await fetch(url);
                        if (!response.ok) {
                            throw new Error(`Failed to fetch ${datasetNameForError} data from ${url}: ${response.status} ${response.statusText}`);
                        }
                        const text = await response.text();
                        return this.parseJsonlContent(text);
                    } catch (e) {
                        console.error(`Error fetching or parsing ${datasetNameForError} dataset:`, e);
                        this.error = (this.error ? this.error + "<br>" : "") + `Could not load ${datasetNameForError} dataset. ${e.message}`;
                        return []; // Return empty array on error for this specific dataset
                    }
                },

                parseJsonlContent(content) {
                    return content.trim().split('\n')
                        .filter(line => line.trim() !== '')
                        .map((line, index) => {
                            try {
                                return JSON.parse(line);
                            } catch (e) {
                                console.error(`Error parsing line ${index + 1} in JSONL: ${line}`, e);
                                throw new Error(`Invalid JSON on line ${index + 1}`);
                            }
                        });
                },

                setActiveDatasetType(type) {
                    if (this.activeDatasetType === type) return;
                    this.activeDatasetType = type;
                    localStorage.setItem('gaia-activeDataset', type);
                    this.sidebarOpen = false;
                    this.applyFiltersAndSearch();
                },

                applyFiltersAndSearch() {
                    this.isLoading = true;
                    this.$nextTick(() => { // Ensure UI updates for loading state
                        setTimeout(() => { // Allow rendering loading state before heavy computation
                            let items = [...this.currentDatasetItems];

                            if (this.searchTerm.trim() !== '') {
                                const lowerSearchTerm = this.searchTerm.toLowerCase();
                                items = items.filter(item =>
                                    (item.task_id && item.task_id.toLowerCase().includes(lowerSearchTerm)) ||
                                    (item.Question && item.Question.toLowerCase().includes(lowerSearchTerm))
                                );
                            }

                            if (this.filterLevels.length < 3 && this.filterLevels.length > 0) {
                                items = items.filter(item => this.filterLevels.includes(item.Level));
                            }

                            if (this.filterHasFile !== 'any') {
                                items = items.filter(item => {
                                    const hasFile = item.file_name && item.file_name.trim() !== '';
                                    return this.filterHasFile === 'yes' ? hasFile : !hasFile;
                                });
                            }

                            items.sort((a, b) => {
                                let valA = a[this.sortBy];
                                let valB = b[this.sortBy];

                                if (typeof valA === 'string') valA = valA.toLowerCase();
                                if (typeof valB === 'string') valB = valB.toLowerCase();
                                if (valA === null || valA === undefined) valA = this.sortOrder === 'asc' ? Infinity : -Infinity;
                                if (valB === null || valB === undefined) valB = this.sortOrder === 'asc' ? Infinity : -Infinity;

                                let comparison = 0;
                                if (valA > valB) comparison = 1;
                                else if (valA < valB) comparison = -1;

                                return this.sortOrder === 'asc' ? comparison : -comparison;
                            });

                            this.filteredItemsCache = items;
                            this.currentPage = 1;
                            this.updatePaginatedItems();
                            this.calculateStats();
                            this.isLoading = false;
                        }, 20); // Minimal delay for rendering
                    });
                },

                updatePaginatedItems() {
                    if (!this.filteredItemsCache) {
                        this.displayedItems = []; this.totalPages = 0; return;
                    }
                    this.totalPages = Math.ceil(this.filteredItemsCache.length / this.itemsPerPage);
                    if (this.totalPages === 0) this.currentPage = 0;
                    else this.currentPage = Math.max(1, Math.min(this.currentPage, this.totalPages));

                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    this.displayedItems = this.filteredItemsCache.slice(start, end);
                },

                goToPage(pageNumber) {
                    if (pageNumber === '...') return;
                    if (pageNumber >= 1 && pageNumber <= this.totalPages) {
                        this.currentPage = pageNumber; this.updatePaginatedItems();
                    }
                },
                nextPage() { if (this.currentPage < this.totalPages) { this.currentPage++; this.updatePaginatedItems(); } },
                prevPage() { if (this.currentPage > 1) { this.currentPage--; this.updatePaginatedItems(); } },
                get paginationPages() {
                    const C = this.currentPage; const T = this.totalPages; if (T === 0) return [];
                    const P = []; const delta = 1; // Show 1 page around current, plus first/last and ellipses
                    let range = [];
                    for (let i = 1; i <= T; i++) {
                        if (i === 1 || i === T || (i >= C - delta && i <= C + delta)) {
                            range.push(i);
                        }
                    }
                    let l;
                    for (let i of range) {
                        if (l) {
                            if (i - l === 2) P.push(l + 1);
                            else if (i - l !== 1) P.push('...');
                        }
                        P.push(i); l = i;
                    }
                    return P;
                },

                clearFilters() {
                    this.searchTerm = ''; this.filterLevels = [1, 2, 3]; this.filterHasFile = 'any';
                    this.sortBy = 'task_id'; this.sortOrder = 'asc'; this.applyFiltersAndSearch();
                },

                openModal(item) {
                    this.selectedItem = item;
                    try {
                        let metadataSource = item['Annotator Metadata'];
                        if (metadataSource && typeof metadataSource === 'string') {
                            try { this.parsedAnnotatorMetadata = JSON.parse(metadataSource); }
                            catch (e) { this.parsedAnnotatorMetadata = { "Metadata": metadataSource }; }
                        } else if (metadataSource && typeof metadataSource === 'object') {
                            this.parsedAnnotatorMetadata = metadataSource;
                        } else if (metadataSource) {
                            this.parsedAnnotatorMetadata = { "Metadata": String(metadataSource) };
                        } else { this.parsedAnnotatorMetadata = {}; }
                    } catch (e) {
                        console.warn("Could not process Annotator Metadata:", e);
                        this.parsedAnnotatorMetadata = { "Error": "Could not process metadata." };
                    }
                },
                closeModal() { this.selectedItem = null; this.parsedAnnotatorMetadata = null; },

                getFileLink(fileName, itemContext) {
                    if (!fileName) return '#';
                    // Determine which dataset the item belongs to for correct base path
                    let itemDatasetType = this.activeDatasetType; // Default to active
                    if (itemContext) { // If item context is passed, check its origin
                        const isInTestData = this.allTestData.some(i => i.task_id === itemContext.task_id);
                        const isInValidationData = this.allValidationData.some(i => i.task_id === itemContext.task_id);
                        if (isInTestData) itemDatasetType = 'test';
                        else if (isInValidationData) itemDatasetType = 'validation';
                    }
                    const basePath = `${GITHUB_RAW_BASE_URL}${this.currentDatasetYear}/${itemDatasetType}/`;
                    return basePath + fileName;
                },

                getFileExtension(filename) {
                    if (!filename || typeof filename !== 'string') return 'unknown';
                    return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2).toLowerCase();
                },
                getFileTypeIcon(filename, size = 18) {
                    const ext = this.getFileExtension(filename);
                    let svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path fill-rule="evenodd" d="M4 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4Zm7.5 1.25a.75.75 0 0 0-1.5 0V5h1.5V3.25Zm-4.5 0V5h1.5V3.25a.75.75 0 0 0-1.5 0ZM8 6.75V5h1.5v1.75a.75.75 0 0 0 1.5 0V5H14v.75A2.25 2.25 0 0 1 11.75 8h-3.5A2.25 2.25 0 0 1 6 5.75V5h1.5v1.75a.75.75 0 0 0 1.5 0ZM6.25 10A.75.75 0 0 0 7 9.25H4.75v1.5H7a.75.75 0 0 0-.75-.75Zm3.25-.75A.75.75 0 0 1 10 10h3.25V8.5H10a.75.75 0 0 1-.75-.75Zm.75 2A.75.75 0 0 0 9.5 12v1.25H7.75A2.25 2.25 0 0 1 5.5 11V8.5H4V14a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V8.5h-1.5v2.75a2.25 2.25 0 0 1-2.25 2.25H10a.75.75 0 0 0-.75.75Z" clip-rule="evenodd" /></svg>`; // Generic file
                    switch (ext) {
                        case 'txt':
                        case 'md':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5Zm4.75 10.75a.75.75 0 0 0 0-1.5H5.5a.75.75 0 0 0 0 1.5h3.75Zm0-2.5a.75.75 0 0 0 0-1.5H5.5a.75.75 0 0 0 0 1.5h3.75Z" clip-rule="evenodd" /></svg>`;
                            break;
                        case 'pdf':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path d="M7.5 3.25A2.75 2.75 0 0 0 4.75 6v1.25c0 .414.336.75.75.75h3.25a.75.75 0 0 0 .75-.75V6.5h1.5v.75a.75.75 0 0 0 .75.75h3.25a.75.75 0 0 0 .75-.75V6A2.75 2.75 0 0 0 12.5 3.25H7.5Zm-2 9A.75.75 0 0 0 6.25 13h7.5a.75.75 0 0 0 0-1.5h-7.5a.75.75 0 0 0-.75.75Zm.75 2.25a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5h-7.5Z" /><path fill-rule="evenodd" d="M4 2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4Zm11.5 1.75a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-1.5a.25.25 0 0 1-.25-.25V4a.25.25 0 0 1 .25-.25h1.5Z" clip-rule="evenodd" /></svg>`;
                            break;
                        case 'jpg': case 'jpeg': case 'png': case 'gif': case 'webp': case 'svg':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path fill-rule="evenodd" d="M1 5.25A2.25 2.25 0 0 1 3.25 3h13.5A2.25 2.25 0 0 1 19 5.25v9.5A2.25 2.25 0 0 1 16.75 17H3.25A2.25 2.25 0 0 1 1 14.75v-9.5Zm1.5 5.81v3.69c0 .414.336.75.75.75h13.5a.75.75 0 0 0 .75-.75v-2.69l-2.22-2.219a.75.75 0 0 0-1.06 0l-1.91 1.909a.75.75 0 0 1-1.06 0l-2.02-2.02a.75.75 0 0 0-1.06 0L2.5 11.06ZM11.75 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" clip-rule="evenodd" /></svg>`;
                            break;
                        case 'xlsx': case 'csv':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path fill-rule="evenodd" d="M2.5 2A1.5 1.5 0 0 0 1 3.5v13A1.5 1.5 0 0 0 2.5 18h15a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H2.5Zm4.25 1.5h3.628L12.5 5.621V7h1.5V5.621a1.5 1.5 0 0 0-.44-1.06L9.439 1.439A1.5 1.5 0 0 0 8.38 1H4.25a1.5 1.5 0 0 0-1.5 1.5v13a1.5 1.5 0 0 0 1.5 1.5h11.5a1.5 1.5 0 0 0 1.5-1.5v-7h-3.879A1.5 1.5 0 0 1 10.5 9V5.121A1.5 1.5 0 0 1 9 3.75H6.75Z" clip-rule="evenodd" /><path d="M6.5 10.75a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z" /><path d="M6.5 13.25a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z" /></svg>`;
                            break;
                        case 'mp3': case 'wav': case 'ogg': case 'm4a':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path d="M7.787 2.553a.75.75 0 0 0-1.06 0L4.172 5.007A14.107 14.107 0 0 0 2.01 7.653c-.306.732-.597 1.497-.864 2.288a.75.75 0 0 0 .423 1.003l.02.007c.437.158.88.293 1.328.401A14.44 14.44 0 0 0 8 11.73a.75.75 0 0 0 .75-.75V2.75a.75.75 0 0 0-1.023-.729c-.089.035-.176.074-.262.118Zm1.748-.037a.75.75 0 0 1 .438-.695C11.347.95 12.922.25 14.5.25A3.25 3.25 0 0 1 17.75 3.5v8.664c0 .268.11.522.297.702A5.975 5.975 0 0 1 19 14.75a.75.75 0 0 1-1.5 0 4.475 4.475 0 0 0-.759-2.436c-.307-.552-.914-.85-1.605-.61l-.107.037a2.25 2.25 0 0 1-1.09-.052c-.428-.15-.86-.278-1.314-.38a.75.75 0 0 0-.427.995l.02.007c.44.158.88.293 1.327.402.09.022.177.05.262.083a.75.75 0 0 0 .338.818l.107.037c.34.117.718.117 1.058 0l.107-.037a.75.75 0 0 0 .338-.818l-.02-.007c-.44-.158-.88-.293-1.327-.402a2.25 2.25 0 0 1-1.09-.052c-.428-.15-.86-.278-1.314-.38A14.448 14.448 0 0 0 8 11.73V2.75c0-.043.002-.085.006-.127a3.232 3.232 0 0 1 1.529-.107Z" /></svg>`;
                            break;
                        case 'json': case 'jsonl':
                            svgIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="${size}" height="${size}"><path fill-rule="evenodd" d="M10.25 2.75A1.75 1.75 0 0 0 8.5 4.5v11A1.75 1.75 0 0 0 10.25 17h4.5A1.75 1.75 0 0 0 16.5 15.5v-8l-5.25-5.25h-1ZM10.5 9V4.81L14.69 9H10.5Z" clip-rule="evenodd" /><path d="M4.75 2.25A2.25 2.25 0 0 0 2.5 4.5v11A2.25 2.25 0 0 0 4.75 17.75H7.5a.75.75 0 0 0 0-1.5H4.75a.75.75 0 0 1-.75-.75V4.5a.75.75 0 0 1 .75-.75h2.75a.75.75 0 0 0 0-1.5H4.75Z" /></svg>`;
                            break;
                    }
                    return svgIcon;
                },

                formatMetadataKey(key) {
                    return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                },

                calculateStats() {
                    const dataToStat = this.filteredItemsCache || [];
                    this.stats.totalDisplayed = dataToStat.length;
                    this.stats.totalInDataset = this.currentDatasetItems.length;
                    this.stats.countByLevel = dataToStat.reduce((acc, item) => {
                        acc[item.Level] = (acc[item.Level] || 0) + 1;
                        return acc;
                    }, {});
                    this.stats.withFiles = dataToStat.filter(item => item.file_name && item.file_name.trim() !== '').length;
                },

                scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); },

                toggleTheme() {
                    this.theme = this.theme === 'dark' ? 'light' : 'dark';
                    localStorage.setItem('gaia-theme', this.theme);
                },
                copyToClipboard(text, feedbackRefName) {
                    if (!text) return;
                    navigator.clipboard.writeText(text).then(() => {
                        const feedbackEl = this.$refs[feedbackRefName];
                        if (feedbackEl) {
                            feedbackEl.innerText = 'Copied!';
                            setTimeout(() => { feedbackEl.innerText = ''; }, 1500);
                        }
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        const feedbackEl = this.$refs[feedbackRefName];
                        if (feedbackEl) {
                            feedbackEl.innerText = 'Failed!';
                            setTimeout(() => { feedbackEl.innerText = ''; }, 1500);
                        }
                    });
                }
            }
        }
    </script>
</body>

</html>